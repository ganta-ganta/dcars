<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment - GoPanda Cars</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Previous head content remains the same -->
</head>
  <style>
    body {
      background-color: #f8f9fa;
    }
    .payment-container {
      max-width: 800px;
      margin: 30px auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      padding: 30px;
    }
    .payment-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .payment-method {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      transition: all 0.3s;
    }
    .payment-method:hover {
      border-color: #0d6efd;
      box-shadow: 0 0 10px rgba(13, 110, 253, 0.2);
    }
    .payment-method.active {
      border-color: #0d6efd;
      background-color: #f0f7ff;
    }
    .payment-method h5 {
      margin-bottom: 15px;
    }
    .payment-details {
      display: none;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
      margin-top: 15px;
    }
    .payment-details.active {
      display: block;
    }
    .qr-code {
      max-width: 200px;
      margin: 15px auto;
      display: block;
    }
    .booking-summary {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
    }
    .whatsapp-float {
      position: fixed;
      width: 60px;
      height: 60px;
      bottom: 40px;
      right: 40px;
      background-color: #25d366;
      color: #FFF;
      border-radius: 50px;
      text-align: center;
      font-size: 30px;
      box-shadow: 2px 2px 3px #999;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.4s;
      text-decoration: none;
    }
    .whatsapp-float:hover {
      background-color: #128C7E;
      transform: scale(1.05);
    }
  </style>
<body>
  <!-- Header -->
  <header class="bg-dark sticky-top">
    <nav class="navbar navbar-expand-lg navbar-dark container">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">
          <h1 class="m-0">GoPanda Cars</h1>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="profile.html">Profile</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="login.html" id="loginLink">Login</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>
  <!-- Previous header and content remains the same until the success modal -->

  <!-- Payment Verification Modal -->
  <div class="modal fade" id="verifyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Verify Payment</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="verifyForm">
            <div class="mb-3">
              <label class="form-label">Transaction ID/Reference</label>
              <input type="text" class="form-control" id="transactionId" required 
                     placeholder="Enter your transaction ID or reference number">
            </div>
            <div class="mb-3">
              <label class="form-label">Payment Amount (â‚¹)</label>
              <input type="number" class="form-control" id="paymentAmount" required 
                     placeholder="Enter the amount you paid">
            </div>
            <div class="mb-3">
              <label class="form-label">Payment Date</label>
              <input type="date" class="form-control" id="paymentDate" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Screenshot (Optional but recommended)</label>
              <input type="file" class="form-control" id="paymentScreenshot" accept="image/*">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="submitVerificationBtn">Submit Verification</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Verification Submitted Modal -->
  <div class="modal fade" id="verificationSubmittedModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body text-center p-5">
          <div class="text-info mb-4">
            <i class="fas fa-hourglass-half" style="font-size: 5rem;"></i>
          </div>
          <h3 class="mb-3">Verification Submitted</h3>
          <p>Your payment details have been submitted for admin verification.</p>
          <p>We'll notify you once your payment is confirmed.</p>
          <p class="text-muted">Booking ID: <span id="verificationBookingId"></span></p>
          <button class="btn btn-primary mt-3" data-bs-dismiss="modal">View Bookings</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Previous script content remains the same until the submit verification part

    // Submit Verification
    document.getElementById('submitVerificationBtn').addEventListener('click', function() {
      const transactionId = document.getElementById('transactionId').value;
      const paymentAmount = document.getElementById('paymentAmount').value;
      const paymentDate = document.getElementById('paymentDate').value;
      const screenshotFile = document.getElementById('paymentScreenshot').files[0];
      
      if (!transactionId || !paymentAmount || !paymentDate) {
        alert('Please fill all required fields');
        return;
      }
      
      // Create a loading state
      const btn = this;
      btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Submitting...';
      btn.disabled = true;
      
      // Prepare payment data
      const paymentData = {
        transactionId: transactionId,
        amount: parseFloat(paymentAmount),
        date: paymentDate,
        method: document.querySelector('input[name="paymentMethod"]:checked').value,
        verified: false,
        verifiedBy: null,
        verifiedAt: null
      };
      
      // If screenshot is uploaded, handle it (you'll need Firebase Storage for full implementation)
      if (screenshotFile) {
        // In a real implementation, you would upload this to Firebase Storage
        paymentData.screenshotFilename = `payment_${bookingId}_${Date.now()}.${screenshotFile.name.split('.').pop()}`;
        // Here we just store the filename, actual upload would require additional code
      }
      
      // Update booking status in Firestore
      db.collection('bookings').doc(bookingId).update({
        status: 'awaiting_admin_verification',
        paymentDetails: paymentData,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      })
      .then(() => {
        verifyModal.hide();
        document.getElementById('verificationBookingId').textContent = bookingId;
        
        // Show verification submitted modal
        const submittedModal = new bootstrap.Modal(document.getElementById('verificationSubmittedModal'));
        submittedModal.show();
        
        // Redirect to profile after 5 seconds
        setTimeout(() => {
          window.location.href = 'profile.html';
        }, 5000);
      })
      .catch(error => {
        console.error('Error updating booking:', error);
        alert('Error submitting verification. Please try again or contact support.');
      })
      .finally(() => {
        btn.innerHTML = 'Submit Verification';
        btn.disabled = false;
      });
    });

    // Admin verification would be handled in a separate admin panel
    // Here's an example of how you might update the booking when admin verifies:
    function adminVerifyPayment(bookingId, adminId) {
      db.collection('bookings').doc(bookingId).update({
        status: 'confirmed',
        'paymentDetails.verified': true,
        'paymentDetails.verifiedBy': adminId,
        'paymentDetails.verifiedAt': firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      })
      .then(() => {
        // Send notification to user that their booking is confirmed
        // This would require implementing a notification system
        console.log('Payment verified by admin');
      })
      .catch(error => {
        console.error('Error verifying payment:', error);
      });
    }

    // Previous remaining script content
  </script>
</body>
</html>
